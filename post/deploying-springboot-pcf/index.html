<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Deploying Spring Boot Application to PCF (Pivotal Cloud Foundry) | SUJIT TRIPATHY</title>
<link rel="stylesheet" href="https://sujittripathy.github.io/css/style.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/github.min.css">


<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://sujittripathy.github.io"><h1 class="title is-4">SUJIT TRIPATHY</h1></a>
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="https://www.linkedin.com/in/sujittripathy" target="_blank">
            <span class="icon">
              <i class="fa fa-linkedin"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://github.com/sujittripathy" target="_blank">
            <span class="icon">
              <i class="fa fa-github-square"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://twitter.com/sujittri" target="_blank">
            <span class="icon">
              <i class="fa fa-twitter-square"></i>
            </span>
          </a>
          
        </nav>
      </div>
      <div class="nav-right">
        <nav class="nav-item is-mobile">
            <a href="/"> Blog </a>
        </nav>
        <nav class="nav-item is-mobile">
            <a href="/main/about-me/"> About </a>
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    
      <h2 class="subtitle is-6">March 28, 2018</h2>
    
    <h1 class="title">Deploying Spring Boot Application to PCF (Pivotal Cloud Foundry)</h1>
    
      <div class="tags">
    
        
        <a class="button is-link" href="#">Cloud-Native</a>
    
        
        <a class="button is-link" href="#">Spring PCF</a>
    
</div>

    
    <div class="content">
      

<p>PaaS (Platform as a Service) is changing the way of how we build production ready software in a much faster and simpler way. Pivotal Cloud Foundry (PCF) is a major commercial version of open source Cloud Foundry. As part of this post, I have take a sample spring boot application and deploying the same to PCF via CLI. The demo application has two REST api end point <code>/addTask</code> and <code>/fetchTasks</code> for adding a new task to ToDo and fetch all the ToDo tasks. Application is deployed as a self contained fat jar with embedded tomcat.</p>

<h2 id="clone-the-source-code-from-github-repository">Clone the source code from GitHub repository</h2>

<p><a href="https://github.com/sujittripathy/ToDoPlannerCF">https://github.com/sujittripathy/ToDoPlannerCF</a></p>

<h2 id="create-a-deployment-artifact-jar">Create a deployment artifact (jar)</h2>

<p>After cloning the code, on the project root execute below command to create maven jar artifact. This will create the self contained jar at <code>/target</code> path.</p>

<pre><code>mvn package
</code></pre>

<h2 id="start-the-application-in-local">Start the application in local</h2>

<p>To verify application running in location, run the target jar.</p>

<pre><code>java -jar ToDoPlannerCF-0.0.1-SNAPSHOT.jar
</code></pre>

<p>Verify if server gets started at port 8080. The REST api should be accessible at <code>http:\\localhost:8080\addTask</code> and <code>http:\\localhost:8080\fetchTasks</code></p>

<pre><code>2018-03-28 21:31:25.775  INFO 9509 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2018-03-28 21:31:25.781  INFO 9509 --- [           main] c.t.T.ToDoPlannerCfApplication           : Started ToDoPlannerCfApplication in 11.394 seconds (JVM running for 12.069)

</code></pre>

<h2 id="let-s-deploy-the-application-to-pcf">Let&rsquo;s deploy the application to PCF</h2>

<p><em>Note: Registration is required at <a href="https://run.pivotal.io">https://run.pivotal.io</a> to deploy to [PCF]. The space need to be created in PCF where app will be deployment prior to pushing the app to PCF.</em></p>

<p>A manifest file need to exists on the project root folder for deployment of application to PCF. This is a type of descriptor file which has properties of application such as name, path, memory requirement, number of instances, service dependency etc. Below is the <code>manifest.yml</code> file for the demo application which we are going to deploy to PCF via CLI. For now, ignore the rabbitmq service dependency.</p>

<pre><code>---
 applications:
 - name: ToDoPlannerCF
   memory: 1gb
   instances: 1
   path: ./target/ToDoPlannerCF-0.0.1-SNAPSHOT.jar
   services:
    - postgress
    - rabbitmq

</code></pre>

<p><strong>Step 1</strong> - Navigate to project root location and execute <code>cf push</code>. PCF will take care of build pack download for specific language (in this case Java) and deploying the same in PCF container via
BOSH.</p>

<pre><code>Binding service rabbitmq to app ToDoPlannerCF in org Neon / space development as tripathy1.kits@gmail.com...
OK

Starting app ToDoPlannerCF in org Neon / space development as tripathy1.kits@gmail.com...
.
.
.
Cell 9a954275-7f82-421f-9904-247e12f74292 creating container for instance 19350fe5-fc36-410f-bfc3-84f43783c815
Cell 9a954275-7f82-421f-9904-247e12f74292 successfully created container for instance 19350fe5-fc36-410f-bfc3-84f43783c815
Downloading build artifacts cache...
Downloading app package...
Downloaded build artifacts cache (132B)
Downloaded app package (33.7M)
-----&gt; Java Buildpack v4.9 (offline) | https://github.com/cloudfoundry/java-buildpack.git#830f4c3
-----&gt; Downloading Jvmkill Agent 1.12.0_RELEASE from https://java-buildpack.cloudfoundry.org/jvmkill/trusty/x86_64/jvmkill-1.12.0_RELEASE.so (found in cache)
-----&gt; Downloading Open Jdk JRE 1.8.0_162 from https://java-buildpack.cloudfoundry.org/openjdk/trusty/x86_64/openjdk-1.8.0_162.tar.gz (found in cache)
       Expanding Open Jdk JRE to .java-buildpack/open_jdk_jre (1.1s)
       JVM DNS caching disabled in lieu of BOSH DNS caching
-----&gt; Downloading Open JDK Like Memory Calculator 3.10.0_RELEASE from https://java-buildpack.cloudfoundry.org/memory-calculator/trusty/x86_64/memory-calculator-3.10.0_RELEASE.tar.gz (found in cache)
       Loaded Classes: 18656, Threads: 250
-----&gt; Downloading Client Certificate Mapper 1.5.0_RELEASE from https://java-buildpack.cloudfoundry.org/client-certificate-mapper/client-certificate-mapper-1.5.0_RELEASE.jar (found in cache)
-----&gt; Downloading Container Security Provider 1.13.0_RELEASE from
.
.
.

</code></pre>

<p><strong>Step 2</strong> - Verify the status of the app instance with the command <code>cf apps</code>. The recently application is in started state.</p>

<pre><code>ToDoPlannerCF $cf apps
Getting apps in org Neon / space development as tripathy1.kits@gmail.com...
OK

name                    requested state   instances   memory   disk   urls
ToDoPlannerCF           started           1/1         1G       1G     todoplannercf.cfapps.io

</code></pre>

<p><strong>Step 3</strong> - Let&rsquo;s login to PCF web console and verify the application running status. As we are seeing below the application is running at <code>https://todoplannercf.cfapps.io/</code> which is running in cloud.</p>

<p><img src="/img/spring_boot_deployment_pcf/img1.png" alt="" /></p>

<p>As part of <strong>Last Step</strong>, let&rsquo;s trigger the REST API from postman and verify if the request is executing successfully.</p>

<p><img src="/img/spring_boot_deployment_pcf/img2.png" alt="" /></p>

<p>The API response code was 200 which executed successfully executed and received the To Do task id in response body.</p>

    </div>
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p>Powered by <a href="https://gohugo.io/">Hugo&copy</a> 2018</p>
  </div>
</section>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/languages/go.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/languages/dockerfile.min.js"></script>

<script>hljs.initHighlightingOnLoad();</script>


